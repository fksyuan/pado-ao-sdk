# pado-ao-sdk

## Overview

The pado-ao-sdk helps developers use PADO Network, which provides trustless and confidential computing capabilities. You can learn more about [PADO Network](https://github.com/pado-labs/pado-network).

## Quick Start

- Demos

## Usage

### Installation

#### Install package by npm

```shell
npm install --save @padolabs/pado-ao-sdk
```

#### import wasm

Introduce `lhe.js` into the HTML file as follows:

```html
<!--    When js is introduced, wasm will automatically load -->
<script type="text/javascript" src="https://pado-online.s3.ap-northeast-1.amazonaws.com/resources/v2/lhe.js"></script>

```

The WASM version and SDK version have a strict correspondence. The specific relationship is as follows:

| Wasm Version | SDK Version           | Wasm Link                                                    |
| ------------ | --------------------- | ------------------------------------------------------------ |
| v2           | >=0.2.0               | https://pado-online.s3.ap-northeast-1.amazonaws.com/resources/v2/lhe.js |
| V1           | 0.0.1<= version<0.2.0 | https://pado-online.s3.ap-northeast-1.amazonaws.com/resources/v1/lhe.js |

If you meet the following error in your browser's console:

```shell
_stream_writable.js:57 Uncaught ReferenceError: process is not defined
    at node_modules/readable-stream/lib/_stream_writable.js (_stream_writable.js:57:18)
    at __require2 (chunk-BYPFWIQ6.js?v=4d6312bd:19:50)
```

You can refer to project using vite. [link](https://github.com/pado-labs/pado-ao-demo/blob/main/vite.config.ts)

### Getting Started
#### Type And Enum

##### KeyInfo

```
type KeyInfo = {
    pk: string;
    sk: string;
};
```

##### ChainName

```
type ChainName = 'ao' | 'holesky' | 'ethereum';
```

##### StorageType

```
enum StorageType {
    ARWEAVE = "arweave",
    ARSEEDING = "arseeding"
}
```

##### PriceInfo 

```
interface PriceInfo {
    price: string;
    symbol: string;
}
```

#### Utils

##### Generate Key
```
generateKey(param_obj?: any): Promise<KeyInfo>;
```

Generate public-private key pairs for subsequent submitting  tasks and getting task results.

- Example

```javascript
import {Utils} from "@xudean/pado-ao-sdk";

const keyInfo = await new Utils().generateKey();
```



#### PadoNetworkContractClient

##### Import Client

```javascript
import {PadoNetworkContractClient} from '@padolabs/pado-ao-sdk'
```

##### Instantiate Client

The constructor of the PadoNetworkContractClient.

```javascript
constructor(chainName: ChainName, storageType: StorageType, wallet: any, userKey?: KeyInfo);
```

- **Parameters**
  - chainName: Which chain the client wants to connect to
  - storageType:  Which chain the client wants to storage data
  - wallet: Wallets that interact with the chain
  - userKey (optional): A key pair generated by the `generateKey()` function. If `userKey` is undefined, the client will generate a new one.

***Note:***

> By default, `StorageType` is `ARWEAVE` when `chainName` is `ao`, and `StorageType` is  `ARSEEDING` when `chainName` is `holesky` or `ethereum`.

| chainName | storageType |
| --------- | ----------- |
| ao        | ARWEAVE     |
| holesky   | ARSEEDING   |
| ethereum  | ARSEEDING   |

- **Returns**

- **Example **

```javascript
const chainName = 'ao';
const storageType = StorageType.ARWEAVE
const padoNetworkClient = new PadoNetworkContractClient(chainName, storageType, wallets,keyInfo);
```



##### Upload Data

Uploading data to storage chain.

```
uploadData(data: Uint8Array, dataTag: CommonObject, priceInfo: PriceInfo, encryptionSchema?: EncryptionSchema): Promise<any>;
```

- **Parameters**

  - data: The data to be uploaded, which should be of type `Uint8Array`.

  - dataTag: The data's metadata object.. **Note: Please use the object format, not a string.**

  - priceInfo: The data price symbol. 

    Different chainNames correspond to different symbols.

    | chainName | symbol                    | minimum price(1 means) |
    | --------- | ------------------------- | ---------------------- |
    | ao        | wAR(the Wrapped AR in AO) | 0.000000000001 wAR     |
    | holesky   | ETH                       | 1 wei                  |
    | ethereum  | ETH                       | 1 wei                  |

  
  - encryptionSchema：Parameters used by the algorithm，default is：
  
    ```json
    {
      t: '2',
      n: '3'
    }
    ```
  
- **Returns**
  - dataId：Unique identification of the data
- **Example**

```javascript
//padoNetworkClient is the object instantiated in the previous section 
const data = new Uint8Array([1, 2, 3, 4, 5, 6, 7, 8]);
const dataTag = { 'filename': 'testFileName' };
const priceInfo = { price: '200000000', symbol: 'wAR' };
//chainName='ao',if chainName is holesky or ethereum, wallet should be window.ethereum
const wallet = window.arweaveWallet;

const dataId = await padoNetworkClient.uploadData(data, dataTag, priceInfo);
```



##### Submit Task

Submit a task to PADO Network. And must pay the data fee corresponding to the dataId and the computing fee of the PADO .

```javascript
submitTask(taskType: string, dataId: string): Promise<any>;
```

***Note:*** 

>  **The public key passed when initialising the client is used to encrypt the task result when submitting the task.**

- **Parameters**
  - taskType:  The type of the task, default `0` now
  
  - dataId:  The dataId returned by the uploadData interface.
  
- **Returns**
  - taskId：The id of the task;
- **Example**

```javascript
const userDataId = 'returned by the uploadData';
const taskId = await padoNetworkClient.submitTask(0, userDataId)
```

##### Get Task Result

Get the result of the task.

```
getTaskResult(taskId: string, timeout?: number): Promise<Uint8Array>;
```

***Note***

> **The task result will be decrypted using the private key in the key pair passed when initialising the client, make sure that the submitTask and getTaskResult interfaces are the same PadoNetworkClient instance!**

- **Parameters**
  - taskId: taskId returned by submitTask interface
  - timeout(optional): The timeout in milliseconds for getting the result, if you wait longer than this time a `timeout` exception will be thrown. Default  10000(10 seconds).
- **Returns**
  - Uint8Array:   The result of the task in plain text.
- **Example**

```
const taskId = 'returned by the getTaskResult';
const timeout = 20000;//milliseconds
//The format of data is Uint8Array, you should handle this data additionally, such as saving it to a file etc.
const data = await padoNetworkClient.getTaskResult(taskId,);

```

